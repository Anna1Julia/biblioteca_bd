{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">Editar Usuário</h2>

<form action="{{ url_for('editar_usuario', id=usuario.ID_usuario) }}" method="POST" class="w-50 mx-auto">
  <div class="mb-3">
    <label class="form-label">Nome:</label>
    <input type="text" name="nome" value="{{ usuario.Nome_usuario }}" class="form-control" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Email:</label>
    <input type="email" name="email" value="{{ usuario.Email }}" class="form-control" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Telefone:</label>
    {% set tel = usuario.Numero_telefone or '' %}
    {% set tel = tel|replace(' ','')|replace('(','')|replace(')','')|replace('-','') %}
    {% if tel|length == 11 %}
      {% set tel_fmt = '(' ~ tel[:2] ~ ') ' ~ tel[2:7] ~ '-' ~ tel[7:] %}
    {% else %}
      {% set tel_fmt = tel %}
    {% endif %}
    <input type="tel"
           name="telefone"
           id="telefone"
           class="form-control"
           pattern="\(\d{2}\)\s?\d{5}-\d{4}"
           placeholder="(11) 98765-4321"
           value="{{ tel_fmt }}"
           required>
  </div>

  <div class="mb-3">
    <label class="form-label">Data de Inscrição:</label>
    <input type="date"
           name="data_inscricao"
           value="{{ usuario.Data_inscricao }}"
           class="form-control"
           required>
  </div>

  <button type="submit" class="btn btn-primary">Atualizar</button>
  <a href="{{ url_for('listar_usuarios') }}" class="btn btn-secondary">Cancelar</a>
</form>

<script>
const telefoneInput = document.getElementById('telefone');
if (telefoneInput) {
  telefoneInput.addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 11) value = value.slice(0,11);
    if (value.length > 6) {
      e.target.value = `(${value.slice(0,2)}) ${value.slice(2,7)}-${value.slice(7,11)}`;
    } else if (value.length > 2) {
      e.target.value = `(${value.slice(0,2)}) ${value.slice(2)}`;
    } else {
      e.target.value = value;
    }
  });
}
</script>
{% endblock %}
